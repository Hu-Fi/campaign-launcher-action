name: Create Escrow

on:
  schedule:
    - cron: "0 0 * * *" # Every day at midnight UTC
  workflow_dispatch: # Allow manual run

jobs:
  create-escrow:
    runs-on: ubuntu-latest
    steps:
      - name: Check if CAMPAIGN_LAUNCH_ENABLED is true
        id: check_enable_cron
        run: |
          if [ "${{ secrets.CAMPAIGN_LAUNCH_ENABLED }}" != "true" ]; then
            echo "CAMPAIGN_LAUNCH_ENABLED is not true. Exiting."
            exit 0
          fi
      - uses: actions/checkout@v3
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"
          cache: "yarn"

      - name: Install dependencies
        run: yarn install

      - name: Run launch-campaign script
        run: node launch-campaign.js
        env:
          # Secret environment variables
          WEB3_RPC_URL: ${{ secrets.WEB3_RPC_URL }}
          WEB3_PRIVATE_KEY: ${{ secrets.WEB3_PRIVATE_KEY }}
          S3_ACCESS_KEY: ${{ secrets.S3_ACCESS_KEY }}
          S3_SECRET_KEY: ${{ secrets.S3_SECRET_KEY }}
          # Public or non-sensitive variables from GitHub environment variables
          CHAIN_ID: ${{ env.CHAIN_ID }}
          EXCHANGE_NAME: ${{ env.EXCHANGE_NAME }}
          SYMBOL: ${{ env.SYMBOL }}
          REWARD_TOKEN: ${{ env.REWARD_TOKEN }}
          REWARD_AMOUNT: ${{ env.REWARD_AMOUNT }}
          START_DELAY: ${{ env.START_DELAY }}
          DURATION: ${{ env.DURATION }}
          DAILY_VOLUME_TARGET: ${{ env.DAILY_VOLUME_TARGET }}
          RECORDING_ORACLE: ${{ env.RECORDING_ORACLE }}
          REPUTATION_ORACLE: ${{ env.REPUTATION_ORACLE }}
          ADDITIONAL_DATA: ${{ env.ADDITIONAL_DATA }}
